project(SwiftAtomics Swift C)

add_library(Atomics SHARED
    Sources/Atomics/autogenerated/AtomicBool.swift
    Sources/Atomics/autogenerated/AtomicLazyReference.swift
    Sources/Atomics/autogenerated/HighLevelTypes.swift
    Sources/Atomics/autogenerated/IntegerConformances.swift
    Sources/Atomics/autogenerated/PointerConformances.swift

    Sources/Atomics/AtomicInteger.swift
    Sources/Atomics/AtomicMemoryOrderings.swift
    Sources/Atomics/AtomicOptional.swift
    Sources/Atomics/AtomicRawRepresentable.swift
    Sources/Atomics/AtomicStrongReference.swift
    Sources/Atomics/AtomicValue.swift
    Sources/Atomics/DoubleWord.swift
)

add_library(_AtomicsShims STATIC
    Sources/_AtomicsShims/src/_AtomicsShims.c
)

target_include_directories(_AtomicsShims PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/Sources/_AtomicsShims/include>
)

set_target_properties(Atomics PROPERTIES
    INTERFACE_LINK_DIRECTORIES $<TARGET_LINKER_FILE_DIR:_AtomicsShims>
    INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_Swift_MODULE_DIRECTORY})

target_compile_options(Atomics PUBLIC
    "SHELL: -I ${CMAKE_CURRENT_SOURCE_DIR}/Sources/_AtomicsShims") # provide module map

target_link_libraries(Atomics PUBLIC _AtomicsShims)
